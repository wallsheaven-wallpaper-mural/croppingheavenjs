/*
The MIT License (MIT)

Copyright (c) 2019 WallsHeaven LTD. (WallsHeaven.com) Contact Support: camilo@wallsheaven.com

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/

!function(){var t={},i={loaded:!1},o={v:{loaded:!1},init:function(e){if(!o.v.loaded){i.img.addEventListener("loadHandler",e),i.img.src=i.img.src,i.img.complete&&(o.v.loaded||(o.v.loaded=!0)),i.img.onload=e()}}},n={init:function(){i.img=document.getElementById(t.id),i.parent=i.img.parentNode,n.n0()},n0:function(){o.init(function(){return function(){console.log("loaded-step"),n.n1(),n.n2(),n.n3(),n.n4(),n.n5(),n.n6(),n.n7()}})},n1:function(){d.init()},n2:function(){l.init()},n3:function(){b.init()},n4:function(){m.init()},n5:function(){g.init()},n6:function(){u.initResize()},n7:function(){u.init()}};function p(e){return Object.assign({},e)}this.cropped=function(o){if(i.loaded)return{fancybox:function(e){return function(){"close"==e?("none"==r.Canvas.obj.style.display&&(r.Canvas.obj.style.display="block"),objCanvas.v.open=!1):"open"==e&&(objCanvas.v.open=!0,objCanvas.generateBig())}},setXYZ:function(){return function(){e={};var t=g.v.obj.z.options[g.v.obj.z.selectedIndex].value;e.xy={w:parseFloat(g.v.obj.w.value),h:parseFloat(g.v.obj.h.value),type:t},g.v.xyz.keep1To1&&(ratio=b.v.clientRect.img.width/b.v.clientRect.img.height,e.xy.w=Math.round(e.xy.h*ratio,0),g.v.obj.w.value=e.xy.w),g.v.history.before=e.xy,b.setWH(e.xy)}}};i.loaded=!0;var p=function(){t=Object.assign({},c,o),n.init(),t.callbackAfterInit({setWH:b.setWH,setXY:b.setXY})};return"complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll?p():document.addEventListener("DOMContentLoaded",p),{settings:t,setXY:b.setXY,setWH:b.setWH,objInput:g}};var c={id:"product",previewId:"preview-box",typeObjEventWorks:"box-crop",cropp:{x:0,w:300,h:300,y:0},inputWH:{},callbackAfter:function(){},bgcolor:"rgba(0, 0, 0, 0.8)",previewScale:1.5,previewMaxWH:200,previewBigMaxWH:1e3,showPreview:!0,input:{idX:"x",idY:"y",idZ:"sizetype",type:"cm",keep1To1:"keep1to1"},inputEnabled:!0,showPreviewLabel:!0,ownboxpreviewzoom:'<div id="prb"><canvas style="zoom:90%" id="preview-canvas-big"></canvas></div>',bigImagePreview:"",typePreview:"canvas",rangeZoom:!0,step:0,callbackInsertHtml:function(){},callbackCanvas:function(){},callbackInput:function(){},callbackAfterInit:function(){}},a={},r={},s={},d={v:{},init:function(){null==s.oriW&&(s.oriW=i.img.naturalWidth,s.oriH=i.img.naturalHeight,s.previewScale=t.previewScale,s.bigImagePreview=t.bigImagePreview),s.w=i.img.width,s.h=i.img.height,s.Scale=s.oriW/s.w,s.maxWH=i.img.width>i.img.height?i.img.width:i.img.height,s.document_width=document.body.clientWidth,s.document_height=document.body.clientHeight,s.pageX=i.parent.offsetTop,s.pageY=i.parent.offsetLeft},resize:function(){this.init()}},l={v:{loaded:!1},init:function(){l.v.loaded||(l.v.loaded=!0,this._html())},_html:function(){i.img.style.width="100%",i.parent.insertAdjacentHTML("beforeend",'<div id="coppedlayer"></div><div id="cropped" "><div id="croppedbox" styel="  background-color: yellow;  opacity: 0.5;"><div id="crop-lb"></div><div id="crop-lt"></div><div id="crop-ll"></div><div id="crop-lr"></div> <div class="crop-line bottom"><div class="crop-line-resize crop-resize-bottom"><div class="crop-resize-icon"></div></div></div><div class="crop-line top"><div class="crop-line-resize crop-resize-top"><div class="crop-resize-icon"></div></div></div><div class="crop-line left"><div class="crop-line-resize crop-resize-left"><div class="crop-resize-icon"></div></div></div><div class="crop-line right"><div class="crop-line-resize crop-resize-right"><div class="crop-resize-icon"></div></div></div></div></div>'),r.cropResize={ll:document.getElementById("crop-ll"),lr:document.getElementById("crop-lr"),lt:document.getElementById("crop-lt"),lb:document.getElementById("crop-lb")},a.objCroppedID=document.getElementById("cropped"),a.objCroppedBox=document.getElementById("croppedbox"),t.showPreview&&this._loadPreview(),t.callbackInsertHtml(r)},_loadPreview:function(){null==i.preview&&(i.preview=document.getElementById(t.previewId),i.preview.insertAdjacentHTML("beforeend",'<div id="preview"><div id="preview-w"><span id="presize-w">0</span> <span id="presize-type-w">cm</span></div><div id="preview-h"><span id="presize-h">0</span> <span id="presize-type-h">cm</span></div><div id="preview-img"><div id="preview-work"  data-fancybox="" data-src="#prb"   >'+("canvas"==t.typePreview?'<img src="/static/js/cropp/zoom-in33.png" id="preview-zoomicon"/><canvas id="preview-canvas" ></canvas> '+t.ownboxpreviewzoom:'<img src="'+i.img.src+'" class="jcrop-preview" alt="Preview" id="preview-raw" width="200" />')+"  </div></div> </div>"),"canvas"==t.typePreview&&(r.Canvas={image:new Image,obj:document.getElementById("preview-canvas")},r.Canvas.cxt=r.Canvas.obj.getContext("2d"),r.CanvasBig={image:new Image,obj:document.getElementById("preview-canvas-big")},r.CanvasBig.cxt=r.CanvasBig.obj.getContext("2d")),r.Preview=document.getElementById("preview").style,r.Work=document.getElementById("preview-work"),t.bigImagePreview.length>0&&t.typePreview,r.Img=document.getElementById("preview-img"),r.ID=document.getElementById("preview-raw"))}},m={v:{inputValue:0},init:function(){t.rangeZoom&&null==a.objCroppedBoxCrop&&(a.objCroppedBoxCrop=document.getElementById("box-crop"),a.objCroppedBoxCrop.insertAdjacentHTML("beforeend",'<input type="range" class="sliderZoom" id="crop-range" min = "0" value="0" step="1" >'),a.objCroppedZoom=document.getElementById("crop-range"),m.setMaxInput(),null!=t.cropp.step&&m.setInput(t.cropp.step),a.objCroppedZoom.addEventListener("input",function(e){value=parseInt(a.objCroppedZoom.value),m.setValue(value),xy=b.v.inputSizes.moveSlide,xy.step=value,b.moveSlide(xy)},!0))},resizeInput:function(){t.rangeZoom&&(m.setMaxInput(),m.resetInput(0))},resetInput:function(){t.rangeZoom&&this.setInput(0)},setMaxInput:function(e){a.objCroppedZoom.setAttribute("max",parseInt(s.w)/6+"px"),a.objCroppedZoom.style["max-width"]=s.w+"px"},setInput:function(e){a.objCroppedZoom.value=e,m.setValue(e)},setValue:function(e){this.v.inputValue=parseInt(e)},getValue:function(){return this.v.inputValue}},u={events:{pernamently:{click:"mousedown touchstart pointerdown MSPointerDown",mouseup:"mouseup touchend touchcancel mouseleave",mouseleave:"mouseleave"},dynamic:{moving:"mousemove touchmove pointermove"},locker:{click:!1,moving:!1},typemove:{resize:!1,direction:""},zooming:!1},init:function(){null==i.objEvent&&("parent"==t.typeObjEventWorks?i.objEvent=i.parent:"box-crop"==t.typeObjEventWorks?i.objEvent=document.getElementById("box-crop"):i.objEvent=window,u.addMultiEvents(u.events.pernamently))},addMultiEvents:function(e){Object.keys(e).forEach(function(t){e[t].split(" ").forEach(function(e){u.addEvent(t,e)})})},removeMultiEvents:function(e){Object.keys(e).forEach(function(t){e[t].split(" ").forEach(function(e){u.removeEvent(t,e)})})},addEvent:function(e,t){i.objEvent.addEventListener(t,u.callBack,u._touchEvent(t))},removeEvent:function(e,t){i.objEvent.removeEventListener(t,u.callBack,u._touchEvent(t))},_touchEvent:function(e){return("touchstart"==e||"touchmove"==e)&&{passive:!0}},callBack:function(e){if(window.blockMenuHeaderScroll&&e.preventDefault(),"touchstart"==e.type||"touchmove"==e.type?window.blockMenuHeaderScroll=!0:window.blockMenuHeaderScroll=!1,u.events.dynamic.moving.split(" ").indexOf(e.type)>=0){if(u.events.locker.click){if(u.events.typemove.resize)var i="resize";else if("croppedbox"==e.srcElement.id)i="moving";else i="moving";b.xyz(i,e)}}else u.events.pernamently.mouseup.split(" ").indexOf(e.type)>=0?(u.events.locker.click&&(u.events.locker.click=!1,u.removeMultiEvents(u.events.dynamic),u.events.typemove.resize&&b.xyz(e.type,e)),t.rangeZoom&&("mouseup"!=e.type&&"touchend"!=e.type&&"touchcancel"!=e.type||u.events.zooming&&(u.events.zooming=!1))):u.events.pernamently.click.split(" ").indexOf(e.type)>=0&&(u.events.locker.click||(["crop-lt","crop-ll","crop-lb","crop-lr"].indexOf(e.srcElement.id)>=0?(u.events.typemove.resize=!0,u.events.typemove.direction=e.srcElement.id):u.events.typemove.resize=!1,(u.events.typemove.resize||["croppedbox"].indexOf(e.srcElement.id)>=0)&&(u.addMultiEvents(u.events.dynamic),u.events.locker.click=!0,b.xyz("click",e))),t.rangeZoom&&"crop-range"==e.srcElement.id&&(u.events.zooming=!0))},initResize:function(){window.addEventListener("resize",function(){window.innerWidth!==this.previousWidth&&(s.orient=window.innerHeight>=window.innerWidth?"portrait":"landscape"),null!=this.orientation&&(s.orient=90==Math.abs(this.orientation)?"landscape":"portrait"),("portrait"==s.orient&&s.document_width!=document.body.clientWidth||"landscape"==s.orient&&s.document_width!=document.body.clientWidth)&&("portrait"==s.orient&&Math.abs(s.document_width-document.body.clientWidth)>5||"landscape"==s.orient&&Math.abs(s.document_width-document.body.clientHeight)>5)&&(s.document_width=document.body.clientWidth,s.document_height=document.body.clientHeight,b.resizePhoto())})}},g={v:{xyz:{w:0,h:0,type:"cm",keep1To1:0},obj:{w:{},h:{},type:{},keep1To1:{},z:{}},history:{before:{},click:{},stepstop:0}},init:function(){t.inputEnabled&&(r.PreviewW=document.getElementById("preview-w").style,r.PreviewH=document.getElementById("preview-h").style,t.showPreviewLabel&&(r.PreviewW.cssText="display:block",r.PreviewH.cssText="display:block"),r.PresizeW=document.getElementById("presize-w"),r.PresizeH=document.getElementById("presize-h"),r.PresizeTypeW=document.getElementById("presize-type-w"),r.PresizeTypeH=document.getElementById("presize-type-h"),g.v.obj.w=document.getElementById(t.input.idX),g.v.obj.h=document.getElementById(t.input.idY),g.v.obj.z=document.getElementById(t.input.idZ),g.v.obj.keep1To1=document.getElementById(t.input.keep1To1),null!=t.inputWH.w&&null!=t.inputWH.h&&null!=t.inputWH.type&&(g.v.obj.w.value=t.inputWH.w,g.v.obj.h.value=t.inputWH.h,g.v.xyz.type=t.inputWH.type,g.v.xyz.keep1To1=g.v.obj.keep1To1.checked),g.v.obj.w.addEventListener("keyup",g.setInputEvent(),!1),g.v.obj.h.addEventListener("keyup",g.setInputEvent(),!1),g.v.obj.z.addEventListener("change",g.setInputEvent(),!1),g.v.obj.keep1To1.addEventListener("change",g.setInputEvent(),!1),null!=t.inputWH.w&&null!=t.inputWH.h&&null!=t.inputWH.type&&g.setInput(t.inputWH))},setInputEvent:function(){return function(e){e.srcElement.id==t.input.keep1To1&&(g.v.xyz.keep1To1=g.v.obj.keep1To1.checked);var i=g.v.obj.z.options[g.v.obj.z.selectedIndex].value;e.xy={w:parseFloat(g.v.obj.w.value),h:parseFloat(g.v.obj.h.value),type:i},g.v.xyz.keep1To1&&(ratio=b.v.clientRect.img.width/b.v.clientRect.img.height,e.srcElement.id==t.input.idX||e.srcElement.id==t.input.keep1To1?(e.xy.h=Math.round(e.xy.w/ratio,0),g.v.obj.h.value=e.xy.h):e.srcElement.id==t.input.idY&&(e.xy.w=Math.round(e.xy.h*ratio,0),g.v.obj.w.value=e.xy.w)),g.v.history.before=e.xy,t.callbackInput(e),b.setWH(e.xy)}},setInput:function(e){null!=r.PresizeW&&(r.PresizeW.textContent=e.w,r.PresizeH.textContent=e.h,r.PresizeTypeW.textContent=e.type,r.PresizeTypeH.textContent=e.type)},setUnit:function(e){},setResizing:function(e){_ratioXY={w:Math.floor(g.v.history.click.w*e.w/b.v.clientRect.croppedClick.width),h:Math.floor(g.v.history.click.h*e.h/b.v.clientRect.croppedClick.height),type:g.v.xyz.type},g.v.obj.w.value=_ratioXY.w,g.v.obj.h.value=_ratioXY.h,g.v.xyz.type=_ratioXY.type,this.setInput(_ratioXY)}},b={v:{position:{click:{x:0,y:0},dynamic:{x:0,y:0}},clientRect:{img:{},croppedClick:{}},objCropping:{},inputSizes:{moveSlide:{},rawInput:{},dimensions:{},newRatio:{}},indicator:{resize:!0}},init:function(){null!=t.inputWH.w&&null!=t.inputWH.h&&null!=t.inputWH.type&&(t.cropp=b.unitToPix(t.inputWH)),b.v.objCropping=this.checkInput(t.cropp),b.resizePhoto()},setXY:function(e){b.setCropp(e)},unitToPix:function(e){return tmp={y:0,x:0,w:0,h:0},e.w>e.h?(ratio=s.w/e.w,tmp.w=s.w*s.Scale,tmp.h=e.h*ratio*s.Scale):(ratio=s.h/e.h,tmp.w=e.w*ratio*s.Scale,tmp.h=s.h*s.Scale),tmp},setWH:function(e){m.resetInput(),e.w=parseFloat(e.w),e.h=parseFloat(e.h),b.v.inputSizes.rawInput=p(e),g.setInput(b.v.inputSizes.rawInput),tmp={x:0,y:0,w:0,h:0},tmp={y:0,x:0},e.w>e.h?(ratio=s.w/e.w,tmp.w=s.w,tmp.h=e.h*ratio):(ratio=s.h/e.h,tmp.w=e.w*ratio,tmp.h=s.h),tmpx=this.checkInput(tmp),b.moveSlide(tmpx)},checkInput:function(e){return xyTmp={x:e.x,y:e.y,w:e.w,h:e.h},diffx=e.w-e.x,diffy=e.h-e.y,diffx>s.w&&(xyTmp.w=s.w,xyTmp.x=0),diffy>s.h&&(xyTmp.h=s.h,xyTmp.y=0),xyTmp.w<=0&&(xyTmp.w=s.w),xyTmp.h<=0&&(xyTmp.h=s.h),e.w>s.w?(ratio=s.w/e.w,xyTmp.h=s.h*ratio,xyTmp.w=xyTmp.w):e.h>s.h&&(ratio=s.h/e.h,xyTmp.h=s.h,xyTmp.w=xyTmp.w*ratio),xyTmp.w*=s.Scale,xyTmp.h*=s.Scale,xyTmp},resizePhoto:function(){i.parent.style.cssText="max-width:"+s.oriW+"px",d.resize(),b.v.clientRect.img=i.img.getBoundingClientRect(),null!=s.movingxy?croppToScale=b.v.inputSizes.moveSlide:croppToScale=b.v.objCropping,t.rangeZoom&&b.v.inputSizes.moveSlide.step&&b.v.inputSizes.moveSlide.step>0&&(xyz=s.movingxy={x:croppToScale.x*s.Scale,y:croppToScale.y*s.Scale,w:croppToScale.w*s.Scale,h:croppToScale.h*s.Scale},b.v.indicator.resize=!0),b.moveSlide(croppToScale),null!=objCanvas.v.open&&objCanvas.v.open&&objCanvas.generateBig()},setCropp:function(e){maxX=e.x+e.w,maxX>b.v.clientRect.img.width&&(e.x=b.v.clientRect.img.width-e.w),maxY=e.y+e.h,maxY>b.v.clientRect.img.height&&(e.y=edgeImg.height-e.h),e.x<0&&(e.x=0),e.y<0&&(e.y=0),this.moveSlide(e)},xyz:function(e,i){var o=b._xyzHelperPageXY(i);"click"==e?(b.v.clientRect.croppedClick=a.objCroppedBox.getBoundingClientRect(),b.v.position.click={pageX:o.pageX,pageY:o.pageY},t.inputEnabled&&(g.v.history.click={w:parseFloat(g.v.obj.w.value),h:parseFloat(g.v.obj.h.value),type:g.v.xyz.type})):"moving"!=e&&"resize"!=e&&"mouseleave"!=e||(b.v.position.dynamic={pageX:o.pageX,pageY:o.pageY},b._move(e))},_xyzHelperPageXY:function(e){var t={pageX:0,pageY:0};if("touchstart"==e.type||"touchmove"==e.type||"touchend"==e.type||"touchcancel"==e.type){var i=e.changedTouches[0]||e.changedTouches[0];t.pageX=i.pageX,t.pageY=i.pageY}else"mousedown"==e.type||"mouseup"==e.type||"mousemove"==e.type||"mouseover"==e.type||"mouseout"==e.type||"mouseenter"==e.type||"mouseleave"==e.type?(t.pageX=e.pageX,t.pageY=e.pageY):"pointerdown"!=e.type&&"pointermove"!=e.type||(t.pageX=e.pageX,t.pageY=e.pageY);return t},_directionMovingXYZ:function(){return start=b.v.position.click,end=b.v.position.dynamic,x=start.pageX-end.pageX,y=start.pageY-end.pageY,y>0?v=1:y<0?v=-1:v=0,x>0?h=1:y<0?h=-1:h=0,b.directionMoving={v:v,h:h,x:-1*x,y:-1*y}},_move:function(e){g.v.history.stepstop=0,b.v.clientRect.img=i.img.getBoundingClientRect(),xyMoving=b._directionMovingXYZ(),croppedClick=b.v.clientRect.croppedClick,edgeImg=b.v.clientRect.img,xyRealCropped={x:croppedClick.x-edgeImg.x,y:croppedClick.y-edgeImg.y},"moving"==e?(xy={x:xyRealCropped.x+xyMoving.x,y:xyRealCropped.y+xyMoving.y,w:croppedClick.width,h:croppedClick.height},maxX=xy.x+xy.w,maxX>edgeImg.width&&(xy.x=edgeImg.width-xy.w),maxY=xy.y+xy.h,maxY>edgeImg.height&&(xy.y=edgeImg.height-xy.h),xy.x<0&&(xy.x=0),xy.y<0&&(xy.y=0)):"resize"==e&&("crop-lt"==u.events.typemove.direction?xy={x:xyRealCropped.x,y:xyRealCropped.y+xyMoving.y,w:croppedClick.width,h:croppedClick.height-xyMoving.y}:"crop-lb"==u.events.typemove.direction?xy={x:xyRealCropped.x,y:xyRealCropped.y,w:croppedClick.width,h:croppedClick.height+xyMoving.y}:"crop-lr"==u.events.typemove.direction?xy={x:xyRealCropped.x,y:xyRealCropped.y,w:croppedClick.width+xyMoving.x,h:croppedClick.height}:"crop-ll"==u.events.typemove.direction&&(xy={x:xyRealCropped.x+xyMoving.x,y:xyRealCropped.y,w:croppedClick.width-xyMoving.x,h:croppedClick.height}),maxW=xy.x+xy.w,maxW>edgeImg.width&&(xy.w=edgeImg.width-xy.x),maxH=xy.y+xy.h,maxH>edgeImg.height&&(xy.h=edgeImg.height-xy.y),xy.x<0&&(xOld=xy.x,xy.w+=xOld,xy.x=0),xy.y<0&&(yOld=xy.y,xy.h+=yOld,xy.y=0),g.setResizing(xy)),xyz=s.movingxy={x:xy.x*s.Scale,y:xy.y*s.Scale,w:xy.w*s.Scale,h:xy.h*s.Scale},t.rangeZoom&&b.v.inputSizes.moveSlide.step&&b.v.inputSizes.moveSlide.step>0&&(xyz.step=m.getValue(),ratio=xyz.h/xyz.w,xyz.x-=xyz.step,xyz.y-=ratio*xyz.step,xyz.w+=2*xyz.step,xyz.h+=ratio*xyz.step*2),b.moveSlide(xyz)},moveSlide:function(e){e.step=m.getValue(),b.v.inputSizes.moveSlide=p(e),t.rangeZoom&&(b.v.indicator.resize?(ratio=e.h/e.w,g.v.history.stepstop>0?e.step>g.v.history.stepstop?step=e.step:step=g.v.history.stepstop:step=e.step,e.x+=step,e.y+=ratio*step,e.w-=2*step,e.h-=ratio*step*2):b.v.indicator.resize=!0),xyScale={x:e.x/s.Scale,y:e.y/s.Scale,w:e.w/s.Scale,h:e.h/s.Scale,step:e.step},this.beforStyle(xyScale,b.v.inputSizes.moveSlide),b.styleAdd(xyScale)},beforStyle:function(e,i){t.rangeZoom&&u.events.zooming&&(tmpMove={wx:0,hy:0,x:0,y:0,w:0,h:0,hc:0,wc:0,extraX:0,extraY:0},e.x<0&&(tmpMove.x=e.x,e.x=0),e.y<0&&(tmpMove.y=e.y,e.y=0),maxW=e.x+e.w,maxH=e.y+e.h,maxW>s.w&&(tmpMove.w=maxW-s.w,tmpMove.wc=e.w-(s.w-e.x)),maxH>s.h&&(tmpMove.h=maxH-s.h,tmpMove.hc=e.h-(s.h-e.y)),(0==e.x&&0!=tmpMove.hc||0==e.y&&0!=tmpMove.wc)&&g.v.history.stepstop,(tmpMove.hc>0||tmpMove.wc>0)&&(tmpMove.wx=e.x-tmpMove.wc,tmpMove.hy=e.y-tmpMove.hc,e.x=tmpMove.wx,e.y=tmpMove.hy,e.x<0&&(tmpMove.extraX=e.x,e.x=0),e.y<0&&(tmpMove.extraY=e.y,e.y=0),0==tmpMove.extraY&&0==tmpMove.extraX||g.v.history.stepstop),maxW=e.x+e.w,maxH=e.y+e.h,maxW>s.w&&0==e.x&&(tmpMove.w2=maxW-s.w,0==g.v.history.stepstop?(g.v.history.stepstop=e.step,e.w-=tmpMove.w2):e.w-=tmpMove.w2),maxH>s.h&&0==e.y&&(tmpMove.h2=maxH-s.h,0==g.v.history.stepstop?(g.v.history.stepstop=e.step,e.h-=tmpMove.h2):e.h-=tmpMove.h2))},styleAdd:function(e){a.objCroppedID.style.cssText="top:"+Math.round(e.y)+"px;width:"+Math.round(e.w)+"px;height:"+Math.round(e.h)+"px;left:"+Math.round(e.x)+"px;display:block; box-shadow: 0px 0px 0px "+s.maxWH+"px "+t.bgcolor+"; ",t.showPreview&&("canvas"==t.typePreview?this.previewCanvas(e):this.preview(e))},preview:function(e){sc=s.previewScale,wbg=s.oriW/s.Scale/sc,hbg=s.oriH/s.Scale/sc,w=e.w/sc,h=e.h/sc,x=e.x/sc,y=e.y/sc,r.ID.style.cssText=" width: "+wbg+"px; height: "+hbg+"px; margin-left: -"+x+"px; margin-top: -"+y+"px;  ",r.Img.style.cssText=r.Work.style.cssText=" width: "+w+"px; height: "+h+"px; "},previewCanvas:function(e){objCanvas.v.lastXY=e,objCanvas.generate(e)}};objCanvas={v:{},generateBig:function(){xy=p(objCanvas.v.lastXY),objCanvas.generate(xy,!0)},generate:function(e,o=!1){function n(e=!1,i,n,p,c){return function(){o||t.bigImagePreview.length>0&&(scaleBig=objImageP.image.width/s.oriW,i.x*=scaleBig,i.y*=scaleBig,i.w*=scaleBig,i.h*=scaleBig),objImageP.cxt.clearRect(0,0,n,p),objImageP.cxt.drawImage(objImageP.image,i.x*c,i.y*c,i.w*c,i.h*c,0,0,n,p),t.callbackCanvas(r,i,o,s)}}o?(objImageP=r.CanvasBig,maxWH=t.previewBigMaxWH,maxWH>s.document_width&&(s.document_width<800?maxWH=s.document_width:maxWH=s.document_width/1.1)):(objImageP=r.Canvas,maxWH=t.previewMaxWH),e.w>=e.h?(ratio=e.w/e.h,w=maxWH,h=maxWH/ratio):(ratio=e.h/e.w,w=maxWH/ratio,h=maxWH),o||(w=w*s.previewScale/s.Scale,h=h*s.previewScale/s.Scale),o||(r.Img.style.cssText=r.Work.style.cssText=" width: "+w+"px; height: "+h+"px; ",r.Preview.cssText="max-width: "+w+"px; margin:0 auto "),objImageP.obj.width!=w&&(objImageP.obj.width=w),objImageP.obj.height!=h&&(objImageP.obj.height=h),""==objImageP.image.src?(t.bigImagePreview.length>0?objImageP.image.src=t.bigImagePreview:objImageP.image.src=i.img.src,objImageP.image.onload=n(!0,e,w,h,s.Scale)):n(!1,e,w,h,s.Scale)()}}}();